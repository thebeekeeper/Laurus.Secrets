@model Laurus.Secrets.Models.Password

@{
    ViewBag.Title = "Edit";
}

<h2>Edit</h2>

@using (Html.BeginForm()) {
    @Html.ValidationSummary(true)

    <fieldset>
        <legend>Password</legend>

        @Html.HiddenFor(model => model.PasswordId)

		<div>
			<div>
				<div id="label-one">one</div>
				<input type="text" id="one" />
			</div>
			<div>
				<div id="label-two"></div>
				<input type="text" id="two" />
			</div>
			<div>
				<div id="label-three"></div>
				<input type="text" id="three" />
			</div>
			<div>
				<div id="label-four"></div>
				<input type="text" id="four" />
			</div>

		</div>
        <p>
@*            <input type="submit" value="Save" />*@
			<a href="#" id="submit">edit</a>
        </p>
    </fieldset>
}

<div>
    @Html.ActionLink("Back to List", "Index")
</div>


@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")

    <script type="text/javascript" src="/Scripts/Aes.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            var key = localStorage.getItem("key");

			var cipher = "@Model.EncryptedData";
			var plainText = Aes.Ctr.decrypt(cipher, key, 128);
			var fields = JSON.parse(plainText);
			$("#label-one").text("Name");
			$("#one").val(fields.one);
			$("#label-two").text("Name");
			$("#two").val(fields.two);
			$("#label-three").text("Name");
			$("#three").val(fields.three);
			$("#label-four").text("Name");
			$("#four").val(fields.four);


            $("#submit").click(function () {
            	var plainText = JSON.stringify({ 'one': $("#one").val(), 'two': $("#two").val(), 'three': $("#three").val(), 'four': $("#four").val() });
                var encrypted = Aes.Ctr.encrypt(plainText, key, 128);
                $.post("/Secret/Edit",
                    {
                        EncryptedData: encrypted,
                        PasswordId: @Model.PasswordId,
						UserId: @Model.UserId
                    },
                    function (data, status) {
                        // redirect to list
                    	window.location = "/Secret";
                });
            });
        });
    </script>
}